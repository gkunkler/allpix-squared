# A simulation configuration that creates an electron in the capacitor

[Allpix] # Basic configuration fields
log_level = "INFO" # How verbose the log output will be
log_format = "DEFAULT"
detectors_file = "si_detector.conf" # Location of the detectors configuration file
number_of_events = 1 # Repeat the entire deposition+collection process this many times
# random_seed_core = 12728099196458894486 # Sets the random seed for consistency between read and writing. Not necessary anymore 
random_seed = 12728099196458894484

[GeometryBuilderGeant4]
world_material = "air" # Material outside of the detector

# [DepositionGeant4]
[ignore]
detector = "TestDetector" # Name of the detector
physics_list = FTFP_BERT_LIV # See Geant4 particle list documentation
source_type = "macro" # Runs the following geant4 macro to generate particles
file_name = "macro_e.mac"
number_of_particles = 5 # Number of particles (or macros) per event
max_step_length = 1um
range_cut = 1um

[DepositionPointCharge]
detector = "TestDetector"
# model = "spot"
# position = 0um 0um 0um
# spot_size = 3um
# number_of_charges = 500
model = "fixed"
position = 0um 0um 0um
number_of_charges = 1000

[ElectricFieldReader] # Generates or loads an E-field in the detector 
model = "constant" # Makes the electric field a constant value in the direction of the plates (like an ideal capacitor
bias_voltage = -300V # -100V # -300V # Potential difference between the electrodes (divide by sensor thickness (in cm) to get typical field around 500-2000 V/cm)

[WeightingPotentialReader] # Generates or loads the weighting potential for the detector
detector = "TestDetector"
model = "mesh" # Import the weighting potential from the file below
file_name = "weighting_potential3.apf"
field_mapping = "PIXEL_FULL" # See Chapter 4.5 in manual (Field Maps)
output_plots = 0

[InteractivePropagation]
# [ignore]
max_charge_groups = 500 
charge_per_step = 1

integration_time = 25ns
timestep = 0.05ns # Runge-Kutta time step (default is 0.1)
distance = 0 # 0 uses 1x1 grid of pixels, 1 uses 3x3 grid of pixels
output_plots = 1
output_rms = 1
output_plots_step = 0.1ns # Affects the time duration between log printing and RMS calculations

output_linegraphs = 0
output_linegraphs_collected = 0
output_linegraphs_recombined = 0
output_linegraphs_trapped = 0
output_animations = 0

relative_permittivity = 11.7 # 10.2 for 
coulomb_field_limit = 4e5V/cm # 1e10V/cm #default is 2e10 V/cm # TODO: Perhaps make this based off of distance the charge will travel?
coulomb_distance_limit = 4e-5cm # 4e-5cm is default

enable_diffusion = 1
enable_coulomb_repulsion = 1

propagate_electrons = 1
propagate_holes = 0
include_mirror_charges = 1

# Implementing realistic parameters for CZT
mobility_model = "canali"
# mobility_electron = 1000cm*cm/V/s # 1000cm*cm/V/s
# mobility_hole = 100cm*cm/V/s # 100cm*cm/V/s

# trapping_model = "constant"
# trapping_time_electron = 10us
# trapping_time_hole = 0.07us

# detrapping_model = "constant"
# detrapping_time_electron = 0.4us
# detrapping_time_hole = 0.07us

# recombination_model = "constant"
# lifetime_electron = 10us
# lifetime_hole = 1us

# [TransientPropagation]
[ignore]
max_charge_groups = 1000 
charge_per_step = 30

integration_time = 10ns
timestep = 0.1ns # Runge-Kutta time step (default is 0.1)
distance = 0 # 0 uses 1x1 grid of pixels, 1 uses 3x3 grid of pixels
output_plots = 1
output_rms = 0
output_plots_step = 1ns # Affects the time duration between log printing and RMS calculations

output_linegraphs = 0
output_linegraphs_collected = 0
output_linegraphs_recombined = 0
output_linegraphs_trapped = 0
output_animations = 0

relative_permativity = 11.7 # 10.2 for 
coulomb_field_limit = 4e5V/cm # 1e10V/cm #default is 2e10 V/cm # TODO: Perhaps make this based off of distance the charge will travel?

enable_diffusion = 1
enable_coulomb_repulsion = 1

propagate_electrons = 1
propagate_holes = 1
include_mirror_charges = 1

# Implementing realistic parameters for CZT
mobility_model = "jacoboni"
# mobility_electron = 1000cm*cm/V/s # 1000cm*cm/V/s
# mobility_hole = 100cm*cm/V/s # 100cm*cm/V/s

# trapping_model = "constant"
# trapping_time_electron = 10us
# trapping_time_hole = 0.07us

# detrapping_model = "constant"
# detrapping_time_electron = 0.4us
# detrapping_time_hole = 0.07us

# recombination_model = "constant"
# lifetime_electron = 10us
# lifetime_hole = 1us

[PulseTransfer] # Uses pulse information from TransientPropagation to generate pixel data
detector = "TestDetector"
#timestep = 0.001ns
#max_depth_distance = 1um
output_pulsegraphs = 0

# [VisualizationGeant4] # 3D plot while simulation runs
# # [ignore]
# mode = "gui"
# simple_view = false
# accumulate = true
# display_trajectories = true
# draw_hits = true

[ROOTObjectWriter] # Writes specified objects to root file
file_name = "test_output.root" # File that will be created in output directory
include = "DepositedCharge", "PixelCharge", "PropagatedCharge", "PixelHit" # Objects to be written
#include = "PixelCharge", "PixelHit" # Objects to be written (small-sized ones only)

